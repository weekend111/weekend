<!DOCTYPE html>a
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekend Getaway Deals</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .offer-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .offer-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        @keyframes fade-in-up {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-fade-in-up {
            animation: fade-in-up 0.6s ease-out;
        }
        @keyframes fade-in {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        .animate-fade-in {
            animation: fade-in 0.6s ease-out;
        }
        .lds-dual-ring {
            display: inline-block;
            width: 20px;
            height: 20px;
        }
        .lds-dual-ring:after {
            content: " ";
            display: block;
            width: 16px;
            height: 16px;
            margin: 1px;
            border-radius: 50%;
            border: 3px solid #fff;
            border-color: #fff transparent #fff transparent;
            animation: lds-dual-ring 1.2s linear infinite;
        }
        @keyframes lds-dual-ring {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold text-blue-600">Weekend Escapes</div>
            <nav>
                <a href="#offers" class="text-gray-600 hover:text-blue-600 mx-2 transition-colors">Offers</a>
                <a href="#blog" class="text-gray-600 hover:text-blue-600 mx-2 transition-colors">Blog</a>
                <a href="#how-it-works" class="text-gray-600 hover:text-blue-600 mx-2 transition-colors">How It Works</a>
                <a href="#subscribe" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">Subscribe</a>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="bg-blue-600 text-white py-20 px-4">
        <div class="container mx-auto text-center">
            <h1 class="text-5xl font-extrabold mb-4 animate-fade-in-up">Your Next Adventure is Just a Click Away</h1>
            <p class="text-xl mb-8 opacity-90 animate-fade-in">
                Curated special offers for flights, trains, and hotels. Get away for the weekend without the hassle.
            </p>
        </div>
    </section>
    
    <!-- User Input Section -->
    <section class="py-16 px-4 bg-gray-200">
        <div class="container mx-auto">
            <h2 class="text-4xl font-bold text-center mb-8">Find Your Perfect Getaway</h2>
            <form id="deal-finder-form" class="max-w-3xl mx-auto bg-white p-8 rounded-xl shadow-lg">
                <div class="flex flex-col md:flex-row gap-6 mb-6">
                    <div class="flex-1">
                        <label for="departure" class="block text-gray-700 font-semibold mb-2">Departure Airport</label>
                        <select id="departure" name="departure" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all">
                            <option value="">Select a departure airport</option>
                            <option value="London (LHR)">London (LHR)</option>
                            <option value="New York (JFK)">New York (JFK)</option>
                            <option value="Tokyo (HND)">Tokyo (HND)</option>
                            <option value="Dubai (DXB)">Dubai (DXB)</option>
                            <option value="Paris (CDG)">Paris (CDG)</option>
                            <option value="Sydney (SYD)">Sydney (SYD)</option>
                            <option value="Singapore (SIN)">Singapore (SIN)</option>
                            <option value="Frankfurt (FRA)">Frankfurt (FRA)</option>
                            <option value="Los Angeles (LAX)">Los Angeles (LAX)</option>
                        </select>
                    </div>
                    <div class="flex-1">
                        <label for="destinations" class="block text-gray-700 font-semibold mb-2">Preferred Destinations</label>
                        <select id="destinations" name="destinations" multiple required class="w-full h-32 px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all">
                            <option value="Paris">Paris, France</option>
                            <option value="Prague">Prague, Czech Republic</option>
                            <option value="Rome">Rome, Italy</option>
                            <option value="Amsterdam">Amsterdam, Netherlands</option>
                            <option value="Barcelona">Barcelona, Spain</option>
                            <option value="Berlin">Berlin, Germany</option>
                            <option value="Tokyo">Tokyo, Japan</option>
                            <option value="Dubai">Dubai, UAE</option>
                            <option value="New York">New York, USA</option>
                            <option value="Sydney">Sydney, Australia</option>
                            <option value="Bangkok">Bangkok, Thailand</option>
                            <option value="Cancun">Cancun, Mexico</option>
                            <option value="Rio de Janeiro">Rio de Janeiro, Brazil</option>
                            <option value="Toronto">Toronto, Canada</option>
                            <option value="Cape Town">Cape Town, South Africa</option>
                        </select>
                        <p class="text-sm text-gray-500 mt-2">Hold Ctrl/Cmd to select multiple.</p>
                    </div>
                </div>
                <div class="flex flex-col md:flex-row gap-4">
                    <button type="submit" class="flex-1 bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition-colors shadow-lg">
                        Find My Deals (One-time)
                    </button>
                    <button type="button" id="start-automation" class="flex-1 bg-green-500 text-white font-bold py-3 px-8 rounded-lg hover:bg-green-600 transition-colors shadow-lg">
                        Start Automation
                    </button>
                </div>
            </form>
            <div id="automation-status" class="mt-4 text-center">
                <span id="status-message" class="text-sm text-gray-600"></span>
            </div>
        </div>
    </section>

    <!-- Special Offers Section with Affiliate Sidebar -->
    <section id="offers" class="py-16 px-4 bg-gray-50">
        <div class="container mx-auto">
            <h2 class="text-4xl font-bold text-center mb-12">Curated Weekend Deals</h2>
            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Main Deals Column -->
                <div id="offer-list" class="flex-grow grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Offers will be dynamically loaded here by the JavaScript -->
                    <div id="loading-message" class="col-span-full text-center text-gray-500 text-lg hidden">Searching for deals...</div>
                    <div id="no-deals-message" class="col-span-full text-center text-gray-500 text-lg hidden">No deals found for your selection. Please try different options.</div>
                </div>
                
                <!-- Affiliate Banners Sidebar -->
                <div class="w-full lg:w-1/4">
                    <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-yellow-500">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Partner Deals</h3>
                        <div class="space-y-4">
                            <!-- Placeholder Affiliate Banners (these would be from Rival Payouts or similar networks) -->
                            <a href="#" class="block bg-gray-100 p-4 rounded-lg hover:bg-gray-200 transition-colors">
                                <img src="https://placehold.co/300x150/538d4e/fff?text=Rival+Payouts+Ad" alt="Affiliate Ad" class="rounded-lg w-full mb-2">
                                <p class="text-sm text-center font-semibold text-gray-700">Get a travel insurance quote!</p>
                            </a>
                            <a href="#" class="block bg-gray-100 p-4 rounded-lg hover:bg-gray-200 transition-colors">
                                <img src="https://placehold.co/300x150/d62828/fff?text=Hotel+Partner+Ad" alt="Affiliate Ad" class="rounded-lg w-full mb-2">
                                <p class="text-sm text-center font-semibold text-gray-700">Save on hotel bookings!</p>
                            </a>
                            <a href="#" class="block bg-gray-100 p-4 rounded-lg hover:bg-gray-200 transition-colors">
                                <img src="https://placehold.co/300x150/06d6a0/fff?text=Car+Rental+Partner" alt="Affiliate Ad" class="rounded-lg w-full mb-2">
                                <p class="text-sm text-center font-semibold text-gray-700">Find the cheapest car rentals!</p>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Blog Section -->
    <section id="blog" class="py-16 px-4">
        <div class="container mx-auto">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-4xl font-bold">Latest Travel Blog Post</h2>
                <button id="generate-blog-btn" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors shadow-lg">
                    Generate New Post
                </button>
            </div>
            
            <div id="blog-output-container" class="bg-white p-8 rounded-xl shadow-lg">
                <p class="text-center text-gray-500">Click "Generate New Post" to create an SEO-optimized blog post about weekend getaways.</p>
            </div>
            
        </div>
    </section>

    <!-- How It Works Section -->
    <section id="how-it-works" class="py-16 px-4 bg-gray-200">
        <div class="container mx-auto text-center">
            <h2 class="text-4xl font-bold mb-12">The Subscription Service</h2>
            <div class="grid sm:grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Step 1 -->
                <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-blue-500">
                    <div class="text-4xl text-blue-600 mb-4">
                        <svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">Curated Offers</h3>
                    <p class="text-gray-600">
                        We batch together special offers for flights, hotels, and trains, saving you hours of searching.
                    </p>
                </div>
                <!-- Step 2 -->
                <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-blue-500">
                    <div class="text-4xl text-blue-600 mb-4">
                        <svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">Delivered to Your Inbox</h3>
                    <p class="text-gray-600">
                        Receive a weekly newsletter with hand-picked deals from your preferred departure airport.
                    </p>
                </div>
                <!-- Step 3 -->
                <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-blue-500">
                    <div class="text-4xl text-blue-600 mb-4">
                        <svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-3-3h4m7-16l-4 4m0 0l-4 4m4-4V5m0 10v4m0-4h4m-4 0h-4"></path></svg>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">Book and Go!</h3>
                    <p class="text-gray-600">
                        Click through to book your getaway and enjoy the perfect weekend trip, stress-free.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Subscription Form Section -->
    <section id="subscribe" class="py-16 px-4 bg-blue-600 text-white">
        <div class="container mx-auto text-center">
            <h2 class="text-4xl font-bold mb-4">Ready to Get Started?</h2>
            <p class="text-xl mb-8 opacity-90">Sign up to receive our first batch of special offers!</p>
            <form id="subscription-form" class="max-w-xl mx-auto">
                <div class="flex flex-col md:flex-row gap-4">
                    <input type="email" id="email" name="email" placeholder="Enter your email address" required
                           class="flex-1 px-4 py-3 rounded-lg text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-300 transition-shadow">
                    <button type="submit"
                            class="bg-white text-blue-600 font-bold py-3 px-8 rounded-lg hover:bg-gray-100 transition-colors shadow-lg">
                        Sign Me Up!
                    </button>
                </div>
            </form>
            <div id="message-box" class="mt-4 text-center hidden">
                <p id="message-text" class="text-lg font-semibold bg-green-500 text-white p-3 rounded-lg"></p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 px-4">
        <div class="container mx-auto text-center">
            <p>&copy; 2025 Weekend Escapes. All rights reserved.</p>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

        // Firebase configuration and initialization
        setLogLevel('debug');
        const __app_id = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const __firebase_config = typeof __firebase_config !== 'undefined' ? __firebase_config : '{}';
        const __initial_auth_token = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : undefined;

        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Firebase Authentication and user sign-in
        async function signIn() {
            try {
                if (__initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Firebase authentication error:", error);
            }
        }

        signIn();


        document.addEventListener('DOMContentLoaded', () => {

            const form = document.getElementById('deal-finder-form');
            const startAutomationButton = document.getElementById('start-automation');
            const offerList = document.getElementById('offer-list');
            const loadingMessage = document.getElementById('loading-message');
            const noDealsMessage = document.getElementById('no-deals-message');
            const statusMessage = document.getElementById('status-message');

            const blogBtn = document.getElementById('generate-blog-btn');
            const blogOutput = document.getElementById('blog-output-container');

            let automationInterval = null;

            // --- Mock Web Scraping Data ---
            const allScrapedDeals = [
                { departure: "London (LHR)", destination: "Prague", description: "Return flights on RyanAir.", price: "From $80", image: "https://placehold.co/600x400/FFD166/000?text=RyanAir" },
                { departure: "London (LHR)", destination: "Barcelona", description: "Direct flights to Barcelona on RyanAir.", price: "From $95", image: "https://placehold.co/600x400/06D6A0/000?text=RyanAir" },
                { departure: "London (LHR)", destination: "Paris", description: "Flights and hotel package via Kiwi.", price: "From $170", image: "https://placehold.co/600x400/118AB2/000?text=Kiwi.com" },
                { departure: "New York (JFK)", destination: "Paris", description: "3-star hotel deal in Paris, great location.", price: "From $120", image: "https://placehold.co/600x400/F4A261/000?text=Booking.com" },
                { departure: "New York (JFK)", destination: "Rome", description: "Flights to Rome on Kiwi.com.", price: "From $150", image: "https://placehold.co/600x400/E76F51/000?text=Kiwi.com" },
                { departure: "Tokyo (HND)", destination: "Berlin", description: "Apartment rental in central Berlin.", price: "From $100", image: "https://placehold.co/600x400/E9C46A/000?text=Booking.com" },
                { departure: "Sydney (SYD)", destination: "Bangkok", description: "Short flights and a romantic hotel stay for a perfect trip to the City of Light.", price: "From $210", image: "https://placehold.co/600x400/FFD166/000?text=Bangkok" },
                { departure: "Dubai (DXB)", destination: "Amsterdam", description: "A canal-side hotel and direct flights for a charming weekend break.", price: "From $190", image: "https://placehold.co/600x400/E76F51/000?text=Amsterdam" },
                { departure: "Los Angeles (LAX)", destination: "Cancun", description: "All-inclusive resort deals for a relaxing getaway.", price: "From $350", image: "https://placehold.co/600x400/264653/fff?text=Cancun" },
                { departure: "Frankfurt (FRA)", destination: "Rio de Janeiro", description: "Direct flights for a cultural escape.", price: "From $420", image: "https://placehold.co/600x400/2A9D8F/fff?text=Rio+de+Janeiro" },
                { departure: "Singapore (SIN)", destination: "Tokyo", description: "Flights and a stunning city hotel.", price: "From $310", image: "https://placehold.co/600x400/E9C46A/fff?text=Tokyo" },
            ];

            // --- Function to perform the deal search and display ---
            async function fetchAndDisplayDeals() {
                const departure = document.getElementById('departure').value;
                const destinations = Array.from(document.getElementById('destinations').selectedOptions).map(option => option.value);

                if (!departure || destinations.length === 0) {
                    statusMessage.textContent = 'Please select a departure airport and at least one destination to start automation.';
                    return;
                }

                // Show loading message
                offerList.innerHTML = '';
                loadingMessage.classList.remove('hidden');
                noDealsMessage.classList.add('hidden');
                statusMessage.textContent = 'Searching for deals...';

                try {
                    // Simulate fetching a fresh batch of deals from the "scraped" data
                    const foundDeals = await new Promise(resolve => {
                        setTimeout(() => {
                            const batchedDeals = allScrapedDeals.filter(deal => 
                                deal.departure === departure && destinations.includes(deal.destination)
                            );
                            resolve(batchedDeals);
                        }, 1000); // 1-second delay for demonstration
                    });

                    loadingMessage.classList.add('hidden');
                    
                    if (foundDeals.length > 0) {
                        foundDeals.forEach(deal => {
                            const card = document.createElement('div');
                            card.className = "offer-card bg-white p-6 rounded-xl shadow-lg cursor-pointer";
                            card.innerHTML = `
                                <img src="${deal.image}" alt="Image of ${deal.destination}" onerror="this.onerror=null; this.src='https://placehold.co/600x400/E5E7EB/000?text=Image+Not+Found';" class="rounded-lg mb-4 object-cover w-full h-48">
                                <h3 class="text-2xl font-bold text-gray-900">${deal.destination}</h3>
                                <p class="text-gray-600 my-2">${deal.description}</p>
                                <p class="text-blue-600 font-bold text-xl">${deal.price}</p>
                                <button class="mt-4 w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                    Book Now
                                </button>
                            `;
                            offerList.appendChild(card);
                        });
                        const now = new Date();
                        statusMessage.textContent = `Automation is running. Last updated: ${now.toLocaleTimeString()}`;
                    } else {
                        noDealsMessage.classList.remove('hidden');
                        statusMessage.textContent = `Automation is running. Last updated: ${new Date().toLocaleTimeString()}. No deals found.`;
                    }
                } catch (error) {
                    loadingMessage.classList.add('hidden');
                    offerList.innerHTML = `<p class="col-span-full text-center text-red-500 text-lg">An error occurred while fetching deals. Please try again.</p>`;
                    statusMessage.textContent = 'Automation stopped due to an error.';
                    console.error("Error fetching deals:", error);
                }
            }

            // --- Event Listeners ---
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                // Perform a one-time fetch
                if (automationInterval) {
                    clearInterval(automationInterval);
                    startAutomationButton.textContent = 'Start Automation';
                }
                fetchAndDisplayDeals();
            });

            startAutomationButton.addEventListener('click', function() {
                if (automationInterval) {
                    clearInterval(automationInterval);
                    automationInterval = null;
                    startAutomationButton.textContent = 'Start Automation';
                    statusMessage.textContent = 'Automation stopped.';
                } else {
                    const departure = document.getElementById('departure').value;
                    const destinations = Array.from(document.getElementById('destinations').selectedOptions).map(option => option.value);

                    if (!departure || destinations.length === 0) {
                        statusMessage.textContent = 'Please select a departure airport and at least one destination to start automation.';
                        return;
                    }

                    fetchAndDisplayDeals(); // Initial run
                    automationInterval = setInterval(fetchAndDisplayDeals, 15000); // Run every 15 seconds
                    startAutomationButton.textContent = 'Stop Automation';
                }
            });

            // Subscription form logic
            const subscriptionForm = document.getElementById('subscription-form');
            const messageBox = document.getElementById('message-box');
            const messageText = document.getElementById('message-text');

            subscriptionForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const emailInput = document.getElementById('email');
                const email = emailInput.value;
                
                try {
                    const subscribersCol = collection(db, `/artifacts/${__app_id}/users/subscribers`);
                    await addDoc(subscribersCol, {
                        email: email,
                        subscribedAt: serverTimestamp(),
                    });
                    
                    messageText.textContent = `Thank you for subscribing! We'll send you deals.`;
                    messageBox.className = 'mt-4 text-center block';
                    emailInput.value = '';
                } catch (error) {
                    messageText.textContent = `Error subscribing. Please try again.`;
                    messageBox.className = 'mt-4 text-center block bg-red-500 text-white p-3 rounded-lg';
                    console.error("Error adding document: ", error);
                }
                
                setTimeout(() => {
                    messageBox.className = 'mt-4 text-center hidden';
                }, 5000);
            });
            
            // New SEO Blog Post Automation with Firestore
            blogBtn.addEventListener('click', async () => {
                blogBtn.disabled = true;
                blogBtn.innerHTML = '<span class="lds-dual-ring"></span> Generating...';
                blogOutput.innerHTML = '<p class="text-center text-gray-500">Generating an SEO blog post...</p>';

                const departureAirports = [
                    "London (LHR)", "New York (JFK)", "Tokyo (HND)", "Dubai (DXB)", "Paris (CDG)",
                    "Sydney (SYD)", "Singapore (SIN)", "Frankfurt (FRA)", "Los Angeles (LAX)"
                ];
                const destinationCities = [
                    "Paris", "Prague", "Rome", "Amsterdam", "Barcelona", "Berlin", "Tokyo", "Dubai", 
                    "New York", "Sydney", "Bangkok", "Cancun", "Rio de Janeiro", "Toronto", "Cape Town"
                ];

                const randomDeparture = departureAirports[Math.floor(Math.random() * departureAirports.length)];
                const randomDestination = destinationCities[Math.floor(Math.random() * destinationCities.length)];

                const prompt = `Generate a comprehensive blog post about the best weekend getaway from ${randomDeparture} to ${randomDestination}. The tone should be friendly and informative, and the post should be optimized for SEO, using keywords like 'budget travel from ${randomDeparture}', 'cheap flights to ${randomDestination}', and 'weekend getaway deals'.`;
                
                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    tools: [{ "google_search": {} }],
                    systemInstruction: {
                        parts: [{ text: "Act as an expert travel blogger." }]
                    },
                };
                
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API error: ${response.statusText}`);
                    }

                    const result = await response.json();
                    const generatedText = result.candidates?.[0]?.content?.parts?.[0]?.text;

                    if (generatedText) {
                        // Save the generated blog post to Firestore
                        const blogPostsCol = collection(db, `/artifacts/${__app_id}/public/data/blog_posts`);
                        await addDoc(blogPostsCol, {
                            title: `Your Guide to a Perfect Weekend Trip from ${randomDeparture} to ${randomDestination}`,
                            content: generatedText,
                            createdAt: serverTimestamp(),
                        });
                    } else {
                        blogOutput.innerHTML = '<p class="text-center text-red-500">Failed to generate content. Please try again.</p>';
                    }
                } catch (error) {
                    console.error("Error generating blog post:", error);
                    blogOutput.innerHTML = `<p class="text-center text-red-500">Error: ${error.message}. Please check the console for details.</p>`;
                } finally {
                    blogBtn.disabled = false;
                    blogBtn.innerHTML = 'Generate New Post';
                }
            });

            // Function to render blog posts from Firestore
            function renderBlogPosts(posts) {
                blogOutput.innerHTML = '';
                if (posts.length === 0) {
                    blogOutput.innerHTML = '<p class="text-center text-gray-500">No blog posts yet. Click "Generate New Post" to create one.</p>';
                } else {
                    posts.forEach(post => {
                        const postElement = document.createElement('div');
                        postElement.className = "bg-white p-8 rounded-xl shadow-lg mb-8";
                        postElement.innerHTML = `
                            <h3 class="text-3xl font-bold mb-4 text-gray-900">${post.title}</h3>
                            ${markdownToHtml(post.content)}
                            <p class="text-sm text-gray-500 mt-4">Published: ${new Date(post.createdAt?.toDate()).toLocaleDateString()}</p>
                        `;
                        blogOutput.appendChild(postElement);
                    });
                }
            }

            // Listen for real-time updates from Firestore for blog posts
            const q = query(collection(db, `/artifacts/${__app_id}/public/data/blog_posts`), orderBy("createdAt", "desc"));
            onSnapshot(q, (snapshot) => {
                const posts = [];
                snapshot.forEach((doc) => {
                    posts.push({ id: doc.id, ...doc.data() });
                });
                renderBlogPosts(posts);
            });

            function markdownToHtml(markdown) {
                const lines = markdown.split('\n');
                let html = '';
                let isList = false;

                lines.forEach(line => {
                    if (line.trim().startsWith('* ') || line.trim().startsWith('- ')) {
                        if (!isList) {
                            html += '<ul class="list-disc list-inside mb-4">';
                            isList = true;
                        }
                        const content = line.trim().substring(2).trim();
                        html += `<li class="text-gray-700">${content}</li>`;
                    } else {
                        if (isList) {
                            html += '</ul>';
                            isList = false;
                        }
                        if (line.startsWith('### ')) {
                            html += `<h3 class="text-2xl font-bold mt-8 mb-3 text-gray-800">${line.substring(4)}</h3>`;
                        } else if (line.startsWith('## ')) {
                            html += `<h2 class="text-3xl font-bold mt-8 mb-4 text-gray-900">${line.substring(3)}</h2>`;
                        } else if (line.trim() !== '') {
                            html += `<p class="mb-4 text-gray-700 leading-relaxed">${line}</p>`;
                        }
                    }
                });
                if (isList) {
                    html += '</ul>';
                }
                return html;
            }
        });
    </script>
</body>
</html>
